/*
    Cornerstone Framework v0.9.1

    COPYRIGHT(C) 2012 BY SKTELECOM CO., LTD. ALL RIGHTS RESERVED.
    Released under the Apache License, Version 2.0
*/
define(["backbone","underscore","jquery","transition","jquery.hammer"],function(e,t,n,r){return e.Router.extend({constructor:function(i,s){var o=this;if(this.pages){var u=this.routes={};t.each(this.pages,function(e,i){i=="default"?e&&(u["*path"]=i+"_handler"):e.fragment&&(t.isArray(e.fragment)||(e.fragment=[e.fragment]),t.each(e.fragment,function(e){u[e]=i+"_handler"})),e.el&&n(e.el).hide(),o[i+"_handler"]=function(){var t=arguments;o.runInactive(i);var s=o.currentPageId,u=o.currentPage;o.currentPageId=i,o.currentPage=e,o.runRender.apply(o,arguments);var a=o.findTransition(s,i);if(a){var f={transitionType:a.type,inTarget:{el:e.el},outTarget:{el:u.el},isReverse:a.reverse||!1,done:function(){o.runActive.apply(o,t)}};a.duration&&(f.inTarget.duration=a.duration/2,f.outTarget.duration=a.duration/2),r.launcher(f)}else u&&u.el&&n(u.el).hide(),e.el&&n(e.el).show(),o.runActive.apply(o,arguments)}})}this.dataTransitions={},n(document).on("click","[data-transition]",function(e){var t={type:n(this).attr("data-transition")},r=n(this).attr("data-duration");r&&(t.duration=parseInt(r)),o.dataTransitions[o.currentPageId]=t,e.stopPropagation()}),n(document).on("click",":not([data-transition])",function(e){delete o.dataTransitions[o.currentPageId],e.stopPropagation()}),e.Router.apply(this,arguments)},_findDataTransitionObject:function(e){var n=this.dataTransitions[e];return t.isString(n)?{type:n}:n},_findTransitionObject:function(e,n){if(!this.transitions)return null;var r=this.transitions[e+":"+n];return t.isString(r)?{type:r}:r},findTransition:function(e,t){var n;return(n=this._findDataTransitionObject(e))?(n.reverse=!1,n):(n=this._findDataTransitionObject(t))?(n.reverse=!0,n):(n=this._findTransitionObject(e,t))?(n.reverse=!1,n):(n=this._findTransitionObject(t,e))?(n.reverse=!0,n):null},runRender:function(){if(!this.currentPage||!this.currentPage.render)return;var e=t.isFunction(this.currentPage.render)?this.currentPage.render:this[this.currentPage.render];t.isFunction(e)&&e.apply(this,arguments)},runActive:function(){if(!this.currentPage||!this.currentPage.active)return;var e=t.isFunction(this.currentPage.active)?this.currentPage.active:this[this.currentPage.active];t.isFunction(e)&&e.apply(this,arguments)},runInactive:function(e){if(!this.currentPage||!this.currentPage.inactive)return;var n=t.isFunction(this.currentPage.inactive)?this.currentPage.inactive:this[this.currentPage.inactive];t.isFunction(n)&&n(e)}})})